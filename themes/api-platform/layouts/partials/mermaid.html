{{ if .Store.Get "hasMermaid" }}
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';

        mermaid.initialize({ startOnLoad: true });

        document.addEventListener("DOMContentLoaded", () => {
            mermaid.init(undefined, document.querySelectorAll(".mermaid")).then(() => {
                document.querySelectorAll(".mermaid").forEach((el) => {
                    el.style.opacity = 1;
                    const loader = el.closest(".mermaid-container").querySelector(".mermaid-loader");
                    if (loader) loader.style.display = "none";
                });
            });
        });
    </script>
{{ end }}